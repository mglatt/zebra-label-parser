# Example Home Assistant Automations for Zebra Label Printer
#
# Copy the automations you want into your HA automations.yaml or
# create them via the HA UI (Settings → Automations & Scenes → Create).

# ──────────────────────────────────────────────────────────────────
# 1. PHONE SHARE → PRINT (via iOS Shortcut)
#
# Print a shipping label by sharing a PDF or image from your iPhone.
# The Shortcut sends the file directly to the addon's API — no Home
# Assistant automation or rest_command is needed.
#
# Why direct? Routing base64 file data through HA's automation system
# hits the 32KB event-data limit and the addon isn't reachable at
# localhost from HA Core (they run in separate containers). Posting
# straight to the addon avoids both issues.
#
# Setup — create a Shortcut on your iPhone (one-time):
#   1. Open the Shortcuts app
#   2. Tap "+" to create a new shortcut, name it "Print Label"
#   3. Tap the (i) button at the bottom → enable "Show in Share Sheet"
#   4. Tap "Share Sheet Input" → select "PDFs" and "Images"
#   5. Add action: "Base64 Encode" (input: Shortcut Input)
#   6. Add action: "URL" → enter your addon URL:
#        http://<your-ha-ip>:8099/api/labels/webhook
#   7. Add action: "Get Contents of URL"
#        - Method: POST
#        - Headers: Content-Type = application/json
#        - Request Body: JSON
#          file_base64  = (select "Base64 Encoded" variable)
#          filename     = (select "Shortcut Input" → Name)
#   8. Save the shortcut
#
# Usage:
#   - From any app (Mail, Safari, Files, etc.), tap the Share button
#   - Select "Print Label" from the share sheet
#   - The label prints automatically
#
# Note: This works when your phone is on the same network as HA.
# For remote printing, use a VPN (e.g., Tailscale or WireGuard).
# ──────────────────────────────────────────────────────────────────

# ──────────────────────────────────────────────────────────────────
# 2. FOLDER WATCHER → AUTO-PRINT
#
# Watches a folder for new PDF files and auto-prints them.
# Great with a network share — users just drop files in a folder.
#
# Setup:
#   1. Add to configuration.yaml:
#
#      homeassistant:
#        allowlist_external_dirs:
#          - "/share/shipping_labels"
#
#      folder_watcher:
#        - folder: "/share/shipping_labels"
#          patterns:
#            - "*.pdf"
#            - "*.png"
#            - "*.jpg"
#
#      rest_command:
#        zebra_print_label:
#          url: "http://localhost:8099/api/labels/webhook"
#          method: POST
#          content_type: "application/json"
#          payload: '{"file_path": "{{ file_path }}"}'
#
#   2. Mount a network share to /share/shipping_labels (via Samba addon)
#   3. Restart HA
# ──────────────────────────────────────────────────────────────────

- alias: "Auto-print shipping labels from watched folder"
  description: "Prints labels automatically when dropped into the shipping_labels folder"
  triggers:
    - trigger: event
      event_type: folder_watcher
      event_data:
        event_type: created
  conditions:
    - condition: template
      value_template: >
        {{ trigger.event.data.path.endswith('.pdf')
           or trigger.event.data.path.endswith('.png')
           or trigger.event.data.path.endswith('.jpg') }}
  actions:
    - action: rest_command.zebra_print_label
      data:
        file_path: "{{ trigger.event.data.path }}"
    # Optional: send a notification when the label is printed
    - action: notify.notify
      data:
        title: "Label Printed"
        message: "Printed shipping label: {{ trigger.event.data.path | basename }}"

# ──────────────────────────────────────────────────────────────────
# 3. DASHBOARD BUTTON → OPEN LABEL PRINTER
#
# Not an automation — just a Lovelace card config.
# Add this to your dashboard YAML:
#
#   type: button
#   name: Print Label
#   icon: mdi:printer
#   tap_action:
#     action: navigate
#     navigation_path: /hassio/ingress/zebra-label-printer
#
# Or use the addon-iframe card (install from HACS):
#
#   type: custom:addon-iframe
#   addon: zebra-label-printer
# ──────────────────────────────────────────────────────────────────
